'use strict';

var truncate = function truncate(str) {
  var size = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 50;
  var postf = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : '...';

  if (str.length > size) {
    return str.substring(0, size - postf.length) + postf;
  }
  return str;
};

var request = new XMLHttpRequest();

request.open('GET', '/data/news/news.json', true);

request.onload = function () {
  if (request.status >= 200 && request.status < 400) {
    var data = JSON.parse(request.responseText);
    var newsList = document.getElementById('news__list');

    var articles = data.reduce(function (acc, article) {
      var maxLength = 400;
      var more = '<a href="" class="news__link news__link--hide">more ></a>';
      if (article.body.length > maxLength) {
        more = '<a href="" class="news__link">more ></a>';
      }
      return '\n        ' + acc + '\n        <article class="news__article">\n          <div class="news__header">\n            <h3 class="news__title">' + article.title + '</h3>\n            <span class="news__date">' + article.date + '</span>\n          </div>\n          <p class="news__body">' + truncate(article.body, maxLength) + '</p>\n          ' + more + '\n        </article>\n        <div class="news__bot-line"></div>\n      ';
    }, '');
    newsList.innerHTML = articles;

    var bodies = document.getElementsByClassName('news__body');

    Array.from(document.getElementsByClassName('news__link')).forEach(function (element, index, links) {
      element.addEventListener('click', function (event) {
        event.preventDefault();
        if (links[index].getAttribute('data-state') === 'full') {
          bodies[index].innerHTML = truncate(data[index].body, 400);
          links[index].innerHTML = 'more >';
          links[index].setAttribute('data-state', 'truncated');
        } else {
          bodies[index].innerHTML = data[index].body;
          links[index].innerHTML = 'hide <';
          links[index].setAttribute('data-state', 'full');
        }
      });
    });
  } else {
    console.log('server error: ', request.status);
  }
};

request.onerror = function () {
  return console.log('loading error');
};

request.send();
"use strict";